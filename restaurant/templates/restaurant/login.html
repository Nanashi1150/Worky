{% load static %}
<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ page_title|default:"‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <style>body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }</style>
  </head>
  <body class="min-h-screen bg-gray-50 flex items-center justify-center p-4 md:p-8">
  <div class="w-full max-w-2xl bg-white rounded-2xl shadow p-4 sm:p-6 md:p-8">
      <div class="text-center mb-6">
        <div class="text-3xl font-bold">üçΩÔ∏è Delicious</div>
        <div class="text-gray-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
      </div>

      <div class="mb-6">
        <div class="flex bg-gray-100 rounded-lg p-1 w-full">
          <button id="loginTab" class="flex-1 py-2 px-4 rounded-md bg-white shadow-sm text-sm font-medium">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          <button id="registerTab" class="flex-1 py-2 px-4 rounded-md text-gray-500 text-sm font-medium">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </div>
      </div>

      <div>
        <!-- Login Form (‡∏ï‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà) -->
        <form id="loginForm" class="space-y-4" method="post" action="/login/">
          {% csrf_token %}
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
            <select id="loginRole" name="loginRole" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <option value="customer">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</option>
              <option value="staff">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
              <option value="chef">‡πÄ‡∏ä‡∏ü</option>
              <option value="rider">‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå</option>
              <option value="admin">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
            <input type="text" id="loginEmail" name="loginEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input type="password" id="loginPassword" name="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
          </div>
          <div class="flex items-center justify-between">
            <a href="#" class="text-sm text-blue-600 hover:underline">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
          </div>
          <!-- Inline error message -->
          <p id="loginError" class="text-sm text-red-600 hidden"></p>
          {% if login_error %}
          <p class="text-sm text-red-600">{{ login_error }}</p>
          {% endif %}
          <!-- Primary login button: gradient ‡∏ï‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå -->
          <button type="submit" class="w-full py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          <!-- Link to Django Admin -->
          <div class="pt-2 text-center">
            <a href="/admin/" class="inline-block text-sm text-gray-600 hover:text-gray-800 underline">‡πÑ‡∏õ‡∏ó‡∏µ‡πà Django Admin</a>
          </div>

          <!-- Removed: third-party login and demo quick-login per requirement -->
          <!-- Removed: auto-login checkbox (no longer recommended) -->
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="space-y-4 hidden" method="post" action="/auth/register/">
          {% csrf_token %}
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</label>
            <input type="text" id="registerUsername" name="registerUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•" />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
              <input type="text" id="registerFirstName" name="registerFirstName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏ä‡∏∑‡πà‡∏≠" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
              <input type="text" id="registerLastName" name="registerLastName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" />
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input type="email" id="registerEmail" name="registerEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus-border-transparent" placeholder="example@email.com" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input type="tel" id="registerPhone" name="registerPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="08xxxxxxxx" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input type="password" id="registerPassword" name="registerPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input type="password" id="registerConfirmPassword" name="registerConfirmPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
          </div>
          {% if register_error %}
          <p class="text-sm text-red-600">{{ register_error }}</p>
          {% endif %}
          <button type="submit" class="w-full py-3 rounded-lg font-semibold text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </form>
      </div>

      <div class="mt-6 text-center text-sm text-gray-500">¬© 2025 Delicious Restaurant</div>
    </div>

    <script>
      function switchAuthTab(tab) {
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        if (tab === 'login') {
          loginForm.classList.remove('hidden');
          registerForm.classList.add('hidden');
          loginTab.classList.add('bg-white');
          loginTab.classList.remove('text-gray-500');
          registerTab.classList.remove('bg-white');
          registerTab.classList.add('text-gray-500');
        } else {
          registerForm.classList.remove('hidden');
          loginForm.classList.add('hidden');
          registerTab.classList.add('bg-white');
          registerTab.classList.remove('text-gray-500');
          loginTab.classList.remove('bg-white');
          loginTab.classList.add('text-gray-500');
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        // Preselect role when coming from /login/<role>/
        try {
          const pre = '{{ preselect_role|default:"" }}';
          if (pre) {
            const sel = document.getElementById('loginRole');
            if (sel) sel.value = pre;
          }
        } catch (e) {}
        document.getElementById('loginTab').addEventListener('click', function(){ switchAuthTab('login'); });
        document.getElementById('registerTab').addEventListener('click', function(){ switchAuthTab('register'); });
        // Default to login tab
        switchAuthTab('login');
        // Client-side validation; let the form POST to server upon success
        const loginForm = document.getElementById('loginForm');
        loginForm.addEventListener('submit', function(e){
          const role = (document.getElementById('loginRole')||{}).value || 'customer';
          const emailEl = document.getElementById('loginEmail');
          const passEl = document.getElementById('loginPassword');
          const errorEl = document.getElementById('loginError');
          const email = (emailEl?.value || '').trim();
          const pass = (passEl?.value || '').trim();

          // reset styles
          [emailEl, passEl].forEach(el => { if (el) { el.classList.remove('border-red-500'); el.classList.add('border-gray-300'); }});
          if (errorEl) { errorEl.textContent = ''; errorEl.classList.add('hidden'); }

          // Basic validation: require both fields; allow email or username; min password length
          const isEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
          const isUsername = /^[A-Za-z0-9_.-]{3,30}$/.test(email);
          if (!email || !pass) {
            if (errorEl) { errorEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'; errorEl.classList.remove('hidden'); }
            if (!email && emailEl) emailEl.classList.add('border-red-500');
            if (!pass && passEl) passEl.classList.add('border-red-500');
            (email ? passEl : emailEl)?.focus();
            e.preventDefault();
            return;
          }
          if (!(isEmail || isUsername)) {
            if (errorEl) { errorEl.textContent = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÉ‡∏™‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)'; errorEl.classList.remove('hidden'); }
            if (emailEl) emailEl.classList.add('border-red-500');
            emailEl?.focus();
            e.preventDefault();
            return;
          }
          if (pass.length < 6) {
            if (errorEl) { errorEl.textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£'; errorEl.classList.remove('hidden'); }
            if (passEl) passEl.classList.add('border-red-500');
            passEl?.focus();
            e.preventDefault();
            return;
          }
          // If valid, allow normal form submission to backend
        });
        // Registration will post to backend; optional client validation can be added later
      });
    </script>
  </body>
</html>
